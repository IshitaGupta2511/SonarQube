pipeline {
    agent any

    stages {
        stage('install-docker') {
            steps {
                sh'''
                sudo yum install docker -y
                sudo systemctl start docker
                sudo systemctl enable docker
                docker network create sonar-network
                '''
            }
        }
        stage('install-sonaqube') {
            steps {
                sh'''
                echo "database container"
                docker run -d --name sonar-db --network sonar-network -e POSTGRES_USER=sonar -e POSTGRES_PASSWORD=sonar -e POSTGRES_DB=sonar postgres:9.6
                echo "Sonar container"
                docker run -d --name sonar -p 9000:9000 --network sonar-network -e SONARQUBE_JDBC_URL=jdbc:postgresql://sonar-db:5432/sonar -e SONAR_JDBC_USERNAME=sonar -e SONAR_JDBC_PASSWORD=sonar sonarqube
                '''
            }
        }
    }
}
